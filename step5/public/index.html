<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agent Orchestration Dashboard</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="shell">
      <header class="hero panel reveal">
        <p class="eyebrow">Local QA Console</p>
        <h1>Agent Orchestration Test Dashboard</h1>
        <p class="subtitle">
          Step5 기준으로 review loop, autonomous rework, budget exhaustion 경로를 한 번에 검증합니다.
        </p>
      </header>

      <section class="panel reveal panel-third" aria-labelledby="diag-title">
        <div class="panel-head">
          <h2 id="diag-title">Diagnostics</h2>
          <button id="refresh-overview" type="button" class="button ghost">Refresh</button>
        </div>

        <div class="diag-grid">
          <button id="ping-health" type="button" class="button">App Health</button>
          <button id="ping-llm" type="button" class="button">LLM Ping</button>
        </div>

        <label for="ping-prompt" class="field-label">LLM Prompt</label>
        <input
          id="ping-prompt"
          type="text"
          value="Respond with one short line: ping accepted"
          autocomplete="off"
        />

        <label for="tool-command" class="field-label">Test Command</label>
        <div class="command-row">
          <input id="tool-command" type="text" value="pnpm test" autocomplete="off" />
          <button id="run-command" type="button" class="button">Run</button>
        </div>

        <pre id="diagnostics-output" class="console" aria-live="polite">No diagnostics yet.</pre>
      </section>

      <section class="panel reveal panel-third" aria-labelledby="run-title">
        <h2 id="run-title">Step5 Session Runner</h2>
        <form id="session-form" class="form-grid">
          <label for="session-preset">Session presets (5)</label>
          <select id="session-preset" aria-describedby="session-preset-help">
            <option value="">시나리오를 선택하세요</option>
          </select>
          <p id="session-preset-help" class="preset-help">
            선택 시 Task, File paths, Test command, Validation commands, Max iterations, Max minutes가 자동으로 채워집니다.
          </p>
          <div id="session-preset-preview" class="preset-preview" role="status" aria-live="polite">
            시나리오를 선택하면 Step5 체크포인트를 미리 보여줍니다.
          </div>

          <label for="task">Task</label>
          <textarea id="task" required placeholder="예: src/utils/json.ts 버그 수정"></textarea>

          <label for="files">File paths (comma-separated)</label>
          <input id="files" required placeholder="src/utils/json.ts,tests/json.test.ts" />

          <label for="test">Test command</label>
          <input id="test" value="pnpm test" />

          <label for="validationCommands">Validation commands (optional)</label>
          <textarea
            id="validationCommands"
            placeholder="pnpm lint&#10;pnpm typecheck&#10;pnpm test"
          ></textarea>
          <p class="field-hint">
            여러 명령은 줄바꿈으로 구분하세요. 비워두면 기본 파이프라인(`pnpm lint -> pnpm typecheck -> testCommand`)을 사용합니다.
          </p>

          <label for="maxIterations">Max iterations</label>
          <input id="maxIterations" type="number" min="1" max="20" value="6" />

          <label for="maxMinutes">Max minutes</label>
          <input id="maxMinutes" type="number" min="1" max="180" value="45" />

          <button id="start-session" type="submit" class="button wide">Start Session</button>
        </form>
      </section>

      <section class="panel reveal panel-third" aria-labelledby="list-title">
        <div class="panel-head">
          <h2 id="list-title">Recent Sessions</h2>
          <button id="refresh-sessions" type="button" class="button ghost">Reload</button>
        </div>
        <div id="sessions-list" class="sessions-list" role="list"></div>
      </section>

      <section class="panel panel-wide reveal" aria-labelledby="status-title">
        <h2 id="status-title">Session Status</h2>
        <pre id="status" class="console status">No session selected.</pre>
      </section>

      <section class="panel panel-wide reveal" aria-labelledby="phase-title">
        <div class="panel-head">
          <h2 id="phase-title">Phase Tracker</h2>
          <span id="phase-meta" class="phase-meta">No session selected.</span>
        </div>
        <div id="phase-tracker" class="phase-tracker" role="list"></div>
      </section>

      <section class="panel panel-wide reveal" aria-labelledby="validation-summary-title">
        <h2 id="validation-summary-title">Step5 Validation Summary</h2>
        <div id="validation-summary" class="console validation-summary" role="status" aria-live="polite"></div>
      </section>

      <section class="panel panel-wide reveal" aria-labelledby="review-summary-title">
        <h2 id="review-summary-title">Review Summary</h2>
        <div id="review-summary" class="console review-summary" role="status" aria-live="polite"></div>
      </section>

      <section class="panel panel-wide reveal" aria-labelledby="budget-status-title">
        <h2 id="budget-status-title">Budget Status</h2>
        <div id="budget-status" class="console budget-status" role="status" aria-live="polite"></div>
      </section>

      <section class="panel panel-wide reveal" aria-labelledby="prompts-title">
        <h2 id="prompts-title">Agent Prompt Logs</h2>
        <div id="prompt-logs" class="console prompt-logs" role="log" aria-live="polite"></div>
      </section>

      <section class="panel panel-wide reveal" aria-labelledby="events-title">
        <h2 id="events-title">Live Event Stream</h2>
        <div class="events-toolbar" role="group" aria-label="Event role filter">
          <label class="filter-chip">
            <input type="checkbox" data-role-filter value="supervisor" checked />
            Supervisor
          </label>
          <label class="filter-chip">
            <input type="checkbox" data-role-filter value="dev" checked />
            Dev
          </label>
          <label class="filter-chip">
            <input type="checkbox" data-role-filter value="test" checked />
            Test
          </label>
          <label class="filter-chip">
            <input type="checkbox" data-role-filter value="planner" checked />
            Planner
          </label>
          <label class="filter-chip">
            <input type="checkbox" data-role-filter value="architect" checked />
            Architect
          </label>
          <label class="filter-chip">
            <input type="checkbox" data-role-filter value="designer" checked />
            Designer
          </label>
          <label class="filter-chip">
            <input type="checkbox" data-role-filter value="reviewer" checked />
            Reviewer
          </label>
        </div>
        <div id="events" class="console events" role="log" aria-live="polite"></div>
      </section>
    </main>

    <script src="/app.js" defer></script>
  </body>
</html>
